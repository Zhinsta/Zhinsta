"undefined"==typeof ukey&&(ukey="");var Apis={like:function(t,o){$.get("/apis/like/",{mid:t,action:"like"},function(t){"ok"===t.result&&o&&o()},"json")},unlike:function(t,o){$.get("/apis/like/",{mid:t,action:"unlike"},function(t){"ok"===t.result&&o&&o()},"json")},islike:function(t,o){$.get("/apis/islike/",{mid:t},function(t){o&&o(t.result)},"json")},follow:function(t,o){$.get("/apis/follow/",{ukey:t,action:"follow"},function(t){"ok"===t.result&&o&&o()},"json")},unfollow:function(t,o){$.get("/apis/follow/",{ukey:t,action:"unfollow"},function(t){"ok"===t.result&&o&&o()},"json")}},Utils={};Utils.format=function(t,o,i){if(!o)return t;var a;if("object"!=typeof o){var e=i?o:"{v}";return a=i||o,t.replace(new RegExp(e,"g"),""+a)}var n=o;return t.replace(i||/\{([^{}]+)\}/g,function(t,o){return a=n[o],void 0!==a?""+a:""})},$("#log").ajaxError(function(){alert("抱歉出错了，请刷新页面重试。如果依旧失败，请联系Zhinsta。Blog: http://zhinsta.diandian.com")}),function(){var t='<div class="tooltip" style="position:absolute;z-index:999;padding:9px;background-color:#FFFED8;border:1px solid #B2B196;box-shadow:3px 3px 0 rgba(0,0,0,0.15);border-radius:1px;color:#666;font-size:14px;">{msg}<b style="{pointBStyle}"><s style="{pointSStyle}"></s></b></div>',o={up:"left",down:"left",right:"top",left:"top"},i={up:"top:-20px;border-bottom-style:solid;border-bottom-color:#B2B196;",down:"bottom:-20px;border-top-style:solid;border-top-color:#B2B196;",right:"right:-20px;border-left-style:solid;border-left-color:#B2B196;",left:"left:-20px;border-right-style:solid;border-right-color:#B2B196;"},a={up:"top:-8px;left:-9px;border-bottom-style:solid;border-bottom-color:#FFFED8;",down:"top:-10px;left:-9px;border-top-style:solid;border-top-color:#FFFED8;",right:"top:-9px;left:-10px;border-left-style:solid;border-left-color:#FFFED8;",left:"top:-9px;left:-8px;border-right-style:solid;border-right-color:#FFFED8;"},e=function(e,n,s){function l(){g.css({top:c[0],left:c[1],width:h}),$("b",g).css(o[f],u),v.append(g)}function r(){g.remove(),s()}var d=n.msg,c=n.position,p=$(n.coordinates),f=n.direction||"up",u=n.offset||0,h=n.width,v=$(e),g=(v.offset(),$(Utils.format(t,{msg:d,direction:f,pointSStyle:"position:absolute;border-width:9px;border-color:transparent;border-style:dashed;width:0;height:0;font-size:0;"+a[f],pointBStyle:"position:absolute;border-width:10px;border-color:transparent;border-style:dashed;width:0;height:0;font-size:0;"+i[f]})));return v.css("position","relative"),p.length&&(p=p.position(),c[0]+=p.top,c[1]+=p.left),l(),{remove:r,$toolTip:g}};$.fn.tooltip=function(t,o){e(t||this[0],o)}}(),$(function(){function t(){this.$loading=$("#loading")}if("undefined"!=typeof gLogined&&gLogined){var o,i={like:'<a href="javascript:void(0);" class="jsLove3" data-action="unlike" data-mid="{mid}"><i class="icon-heart loved"></i></a>',unlike:'<a href="javascript:void(0);" class="jsLove3" data-action="like" data-mid="{mid}"><i class="icon-heart"></i></a>'};$("#photoList").on("mouseenter","li",function(){var t=$(this);t.data("loaded")||(o&&clearTimeout(o),o=setTimeout(function(){o=null,t.data("loaded",!0);var a=t.find(".jsLove3"),e=a.data("mid");e&&Apis.islike(e,function(t){var o=t?i.like:i.unlike;a.replaceWith(Utils.format(o,{mid:e}))})},1e3))}).on("click",".jsLove3",function(){var t=$(this),o=t.data("action"),a=t.data("mid"),e=Apis[o];e(a,function(){t.replaceWith(Utils.format(i[o],{mid:a}))})})}$("body").on("click",".jsLove,.jsLove2",function(t){if(t.preventDefault(),!this.sign){if(this.sign=!0,"undefined"==typeof gLogined||!gLogined){var o=$("<span></span>").insertBefore(this);return void $(this).tooltip(o,{msg:'请先<a href="/">登录</a>',position:[-36,0],offset:8,width:80,direction:"down"})}var i,a=$(this),e=a.data("action"),n=parseInt(a.data("num"),10),s=a.data("mid"),l=Apis[e];i=a.hasClass("jsLove")?{like:'<a href="javascript:void(0);" class="jsLove" data-action="unlike" data-num="{n}" data-mid="{mid}"><i class="icon-heart loved"></i><span class="loved">{n}</span></a>',unlike:'<a href="javascript:void(0);" class="jsLove" data-action="like" data-num="{n}" data-mid="{mid}"><i class="icon-heart"></i><span>{n}</span></a>'}:{like:'<a href="javascript:void(0);" class="jsLove2" data-action="unlike" data-num="{n}" data-mid="{mid}"><span class="loved">{n}</span><i class="icon-heart loved"></i></a>',unlike:'<a href="javascript:void(0);" class="jsLove2" data-action="like" data-num="{n}" data-mid="{mid}"><span>{n}</span><i class="icon-heart"></i></a>'},l(s,function(){"like"===e?n++:n--,a.replaceWith(Utils.format(i[e],{mid:s,n:n}))})}}),$("body").on("click",".jsFollow",function(t){if(t.preventDefault(),!this.sign){if(this.sign=!0,"undefined"==typeof gLogined||!gLogined){var o=$("<span>&nbsp;</span>").insertAfter(this);return void $(this).tooltip(o,{msg:'请先<a href="/">登录</a>',position:[32,-60],offset:10,width:80})}var i=$(this),a=i.data("action"),e=i.data("ukey"),n=Apis[a],s={follow:'<a href="#" class="jsFollow info-follow" data-action="unfollow" data-ukey="{v}" title="取消关注">正在关注</a>',unfollow:'<a href="#" class="jsFollow info-follow" data-action="follow" data-ukey="{v}" title="关注TA">未关注</a>'};n(e,function(){i.replaceWith(Utils.format(s[a],e))})}}),t.prototype.start=function(){var t=this;t.starting||(t.starting=!0,t.$loading.css({transition:"width 3s",width:"60%",opacity:"1"}))},t.prototype.stop=function(){var t=this;t.starting&&(t.starting=!1,t.$loading.css({transition:"width 1s, opacity 1s",width:"100%",opacity:"0"}))};var a=new t;$(document).ajaxStart(function(){a.start()}).ajaxStop(function(){a.stop()})});
